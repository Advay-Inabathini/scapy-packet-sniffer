<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <style>
        body {
            background-color:#111827 ;
        }

        .module {
            background-color: #1F2937;
            padding: 1rem;
            border-radius: 0.5rem;
        }

        .accordion-button:not(.collapsed) {
            color: var(--bs-accordion-active-color);
            background-color: #1F2937;
        }


    </style>
</head>
<body data-bs-theme="dark">
    <div class="container">
        <h1 class="mt-5 mb-2">Packet Capture Summary</h1>
    <div class="module mb-4 border">
        <div class="row">
            <div class="col-lg-6 text-secondary-emphasis">
                <h6 >Total Packets Captured: {{ data.total_packets }}</h6>
            </div>
            <div class="col-lg-6 text-secondary-emphasis" style="text-align: right;">
                <h6>Capture Duration: {{ data.time }} seconds</h6>
            </div>
        </div>
    </div>
    

    <h2>Packets Over Time</h2>
    <div class="module border mb-5">
        <div id="packets-over-time-chart"></div>
    </div>
    
    <div class="row mb-5">
        <div class="col-lg-6">
            <h3>Protocol Distribution</h3>
            <div class="module border">
                <div id="protocol-chart"></div>
            </div>
        </div>
        <div class="col-lg-6">
            
            <h3>Top Talkers</h3>
            <div class="module border">
                <ul>
                    {% for packet in data.top_talkers %}
                        <li>{{packet.website}} {{ packet.src_domain or packet.src_ip }} ({{ packet.count }} packets)</li>
                    {% endfor %}
                </ul>
                
                    </div>
                </div>
            </div>
                   
<div class="mb-5">
    {{ data.insights|safe }}
</div>


    <h3>Few Packets</h3>
    <div class="module border mb-3">
        <table class="table p-5" style="--bs-table-bg: #1F2937">
            <tr>
                <th>Source IP</th>
                <th>Destination IP</th>
                <th>Protocol</th>
                <th>Length</th>
                <th>Info</th>
            </tr>
            {% for packet in data.sample_packets %}
                <tr>
                    <td>{{ packet.src_ip }}</td>
                    <td>{{ packet.dst_ip }}</td>
                    <td>{{ packet.protocol }}</td>
                    <td>{{ packet.length }}</td>
                    <td>{{ packet.info }}</td>
                </tr>
            {% endfor %}
        
    </table>
    </div>
    

    </table>
    
    <a class="btn btn-primary mb-5" href="/">Back to Home</a>

    </div>
    
    <script>
        // JavaScript code to generate protocol distribution chart
        var protocolData = {{ data.protocol_counts|tojson }};
    var protocolLabels = Object.keys(protocolData);
    var protocolValues = Object.values(protocolData);

    var data = [{
        values: protocolValues,
        labels: protocolLabels,
        type: 'pie'
    }];

    var layout = {
        title: 'Protocol Distribution'
    };

    Plotly.newPlot('protocol-chart', data, layout);

    var packetsData = {{ data.packets_per_second|tojson }};
  var timestamps = packetsData.map(x => x[0]);
  var packetCounts = packetsData.map(x => x[1]);

  // Convert timestamps to human-readable format
  var formattedTimestamps = timestamps.map(timestamp => {
    var date = new Date(timestamp * 1000); // Convert Unix epoch to milliseconds
    return date.toLocaleTimeString(); // Convert to local date and time format
  });

  var trace1 = {
    x: formattedTimestamps,
    y: packetCounts,
    mode: 'lines',
    name: 'Packets Received'
  };

  var data = [trace1];

  var layout = {
    title: 'Packets Captured Over Time',
    xaxis: {
      title: 'Time'
    },
    yaxis: {
      title: 'Number of Packets'
    }
  };

  Plotly.newPlot('packets-over-time-chart', data, layout);
  
</script>

</body>
</html>
